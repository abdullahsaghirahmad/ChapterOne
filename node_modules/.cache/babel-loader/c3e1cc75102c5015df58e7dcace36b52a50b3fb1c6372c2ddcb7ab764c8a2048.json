{"ast":null,"code":"import _objectSpread from\"/Users/Projects/ChapterOne/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{ArrowLeftIcon,ChatBubbleLeftIcon,ArrowUpIcon}from'@heroicons/react/24/outline';import axios from'axios';import{BookCard}from'./BookCard';import{normalizeTag}from'./ThreadPage';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const ThreadDetailPage=()=>{var _thread$createdBy;const{id}=useParams();const navigate=useNavigate();const[thread,setThread]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{const fetchThreadDetails=async()=>{try{setLoading(true);const response=await axios.get(\"http://localhost:3001/api/threads/\".concat(id));console.log('Thread details:',response.data);// Process the thread to ensure tags are properly formatted\nlet threadData=response.data;let processedTags=threadData.tags;// If tags is a string that looks like a stringified array, parse it\nif(typeof threadData.tags==='string'){try{processedTags=JSON.parse(threadData.tags);}catch(_unused){// If parsing fails, split by comma\nprocessedTags=threadData.tags.split(',').map(t=>t.trim());}}// Normalize each tag to extract clean string values\nif(Array.isArray(processedTags)){processedTags=processedTags.map(normalizeTag);}else if(processedTags){// If somehow not an array, make it a single-item array\nprocessedTags=[normalizeTag(processedTags)];}else{// Default to empty array if tags is null/undefined\nprocessedTags=[];}setThread(_objectSpread(_objectSpread({},threadData),{},{tags:processedTags}));setLoading(false);}catch(err){console.error('Error fetching thread details:',err);setError('Failed to load thread details. Please try again later.');setLoading(false);}};if(id){fetchThreadDetails();}},[id]);const handleBack=()=>{navigate('/threads');};const handleUpvote=async()=>{if(!thread)return;try{const response=await axios.post(\"http://localhost:3001/api/threads/\".concat(id,\"/upvote\"));setThread(prev=>prev?_objectSpread(_objectSpread({},prev),{},{upvotes:response.data.upvotes}):null);}catch(err){console.error('Error upvoting thread:',err);alert('Failed to upvote. Please try again.');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:\"Loading thread details...\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-red-500\",children:error});}if(!thread){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:\"Thread not found\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-8\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleBack,className:\"flex items-center text-primary-600 hover:text-primary-800\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"w-4 h-4 mr-1\"}),\" Back to threads\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-primary-900\",children:thread.title}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleUpvote,className:\"btn btn-icon\",children:[/*#__PURE__*/_jsx(ArrowUpIcon,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:thread.upvotes})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-primary-600\",children:thread.description}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2 mt-2\",children:thread.tags&&thread.tags.map(tag=>/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-xs rounded-full bg-primary-100 text-primary-700\",children:tag},tag))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm text-primary-500 mt-4 border-t pt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(ChatBubbleLeftIcon,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[thread.comments,\" comments\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[((_thread$createdBy=thread.createdBy)===null||_thread$createdBy===void 0?void 0:_thread$createdBy.username)&&/*#__PURE__*/_jsxs(\"span\",{children:[\"Posted by \",thread.createdBy.username]}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-4\",children:new Date(thread.createdAt).toLocaleDateString()})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"Related Books\"}),thread.books&&thread.books.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3\",children:thread.books.map(book=>/*#__PURE__*/_jsx(BookCard,{title:book.title,author:book.author,coverImage:book.coverImage||'https://via.placeholder.com/150x225?text=No+Cover',description:book.description||'No description available',pace:book.pace||'Moderate',tone:book.tone||[],themes:book.themes||[],isExternal:false},book.id))}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:\"No books associated with this thread\"})]})]});};","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","ArrowLeftIcon","ChatBubbleLeftIcon","ArrowUpIcon","axios","BookCard","normalizeTag","jsx","_jsx","jsxs","_jsxs","ThreadDetailPage","_thread$createdBy","id","navigate","thread","setThread","loading","setLoading","error","setError","fetchThreadDetails","response","get","concat","console","log","data","threadData","processedTags","tags","JSON","parse","_unused","split","map","t","trim","Array","isArray","_objectSpread","err","handleBack","handleUpvote","post","prev","upvotes","alert","className","children","onClick","title","description","tag","comments","createdBy","username","Date","createdAt","toLocaleDateString","books","length","book","author","coverImage","pace","tone","themes","isExternal"],"sources":["/Users/Projects/ChapterOne/src/components/features/ThreadDetailPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { ArrowLeftIcon, ChatBubbleLeftIcon, ArrowUpIcon } from '@heroicons/react/24/outline';\nimport axios from 'axios';\nimport { BookCard } from './BookCard';\nimport { normalizeTag } from './ThreadPage';\n\ninterface Thread {\n  id: string;\n  title: string;\n  description: string;\n  upvotes: number;\n  comments: number;\n  tags: string[];\n  createdAt: string;\n  updatedAt: string;\n  createdBy?: {\n    username: string;\n  };\n  books: {\n    id: string;\n    title: string;\n    author: string;\n    coverImage?: string;\n    description?: string;\n    publishedYear?: string;\n    pace?: string;\n    tone?: string[];\n    themes?: string[];\n    rating?: number;\n  }[];\n}\n\ninterface UpvoteResponse {\n  upvotes: number;\n}\n\nexport const ThreadDetailPage: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [thread, setThread] = useState<Thread | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    const fetchThreadDetails = async () => {\n      try {\n        setLoading(true);\n        const response = await axios.get<Thread>(`http://localhost:3001/api/threads/${id}`);\n        console.log('Thread details:', response.data);\n        \n        // Process the thread to ensure tags are properly formatted\n        let threadData = response.data;\n        let processedTags = threadData.tags;\n        \n        // If tags is a string that looks like a stringified array, parse it\n        if (typeof threadData.tags === 'string') {\n          try {\n            processedTags = JSON.parse(threadData.tags as any);\n          } catch {\n            // If parsing fails, split by comma\n            processedTags = (threadData.tags as any).split(',').map((t: string) => t.trim());\n          }\n        }\n        \n        // Normalize each tag to extract clean string values\n        if (Array.isArray(processedTags)) {\n          processedTags = processedTags.map(normalizeTag);\n        } else if (processedTags) {\n          // If somehow not an array, make it a single-item array\n          processedTags = [normalizeTag(processedTags)];\n        } else {\n          // Default to empty array if tags is null/undefined\n          processedTags = [];\n        }\n        \n        setThread({\n          ...threadData,\n          tags: processedTags\n        });\n        \n        setLoading(false);\n      } catch (err) {\n        console.error('Error fetching thread details:', err);\n        setError('Failed to load thread details. Please try again later.');\n        setLoading(false);\n      }\n    };\n\n    if (id) {\n      fetchThreadDetails();\n    }\n  }, [id]);\n\n  const handleBack = () => {\n    navigate('/threads');\n  };\n\n  const handleUpvote = async () => {\n    if (!thread) return;\n    \n    try {\n      const response = await axios.post<UpvoteResponse>(`http://localhost:3001/api/threads/${id}/upvote`);\n      setThread(prev => prev ? { ...prev, upvotes: response.data.upvotes } : null);\n    } catch (err) {\n      console.error('Error upvoting thread:', err);\n      alert('Failed to upvote. Please try again.');\n    }\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-8\">Loading thread details...</div>;\n  }\n\n  if (error) {\n    return <div className=\"text-center py-8 text-red-500\">{error}</div>;\n  }\n\n  if (!thread) {\n    return <div className=\"text-center py-8\">Thread not found</div>;\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Back button */}\n      <button\n        onClick={handleBack}\n        className=\"flex items-center text-primary-600 hover:text-primary-800\"\n      >\n        <ArrowLeftIcon className=\"w-4 h-4 mr-1\" /> Back to threads\n      </button>\n\n      {/* Thread header */}\n      <div className=\"card\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex justify-between\">\n            <h1 className=\"text-2xl font-bold text-primary-900\">{thread.title}</h1>\n            <button\n              onClick={handleUpvote}\n              className=\"btn btn-icon\"\n            >\n              <ArrowUpIcon className=\"w-5 h-5\" />\n              <span>{thread.upvotes}</span>\n            </button>\n          </div>\n\n          <p className=\"text-primary-600\">{thread.description}</p>\n\n          <div className=\"flex flex-wrap gap-2 mt-2\">\n            {thread.tags && thread.tags.map((tag) => (\n              <span\n                key={tag}\n                className=\"px-2 py-1 text-xs rounded-full bg-primary-100 text-primary-700\"\n              >\n                {tag}\n              </span>\n            ))}\n          </div>\n\n          <div className=\"flex items-center justify-between text-sm text-primary-500 mt-4 border-t pt-4\">\n            <div className=\"flex items-center gap-2\">\n              <ChatBubbleLeftIcon className=\"w-4 h-4\" />\n              <span>{thread.comments} comments</span>\n            </div>\n            <div>\n              {thread.createdBy?.username && (\n                <span>Posted by {thread.createdBy.username}</span>\n              )}\n              <span className=\"ml-4\">\n                {new Date(thread.createdAt).toLocaleDateString()}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Associated Books */}\n      <div className=\"mt-8\">\n        <h2 className=\"text-xl font-semibold mb-4\">Related Books</h2>\n        \n        {thread.books && thread.books.length > 0 ? (\n          <div className=\"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3\">\n            {thread.books.map((book) => (\n              <BookCard\n                key={book.id}\n                title={book.title}\n                author={book.author}\n                coverImage={book.coverImage || 'https://via.placeholder.com/150x225?text=No+Cover'}\n                description={book.description || 'No description available'}\n                pace={book.pace as 'Fast' | 'Moderate' | 'Slow' || 'Moderate'}\n                tone={book.tone || []}\n                themes={book.themes || []}\n                isExternal={false}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-8\">\n            No books associated with this thread\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}